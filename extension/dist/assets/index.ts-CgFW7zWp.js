import{c as Me,e as X}from"./profile-DccX_sEz.js";import{t as K,a as ve}from"./constants-BqRKAH88.js";const k="scrollBatches",C="scrollBatchesInFlight";let p=new Map,m=new Map;function T(e){return{...e}}function F(e,s){for(const t of s){const o=e.get(t.site);o?(o.totalPixels+=t.totalPixels,o.totalMeters+=t.totalMeters,o.sessionStart=Math.min(o.sessionStart,t.sessionStart),o.lastUpdate=Math.max(o.lastUpdate,t.lastUpdate)):e.set(t.site,T(t))}}function j(e){if(!e||typeof e!="object")return new Map;const s=Object.entries(e);return new Map(s.map(([t,o])=>[t,T(o)]))}function we(e,s,t){const o=p.get(e);o?(o.totalPixels+=s,o.totalMeters+=t,o.lastUpdate=Date.now()):p.set(e,{site:e,totalPixels:s,totalMeters:t,sessionStart:Date.now(),lastUpdate:Date.now()}),_()}async function _(){await chrome.storage.local.set({[k]:Object.fromEntries(p),[C]:Object.fromEntries(m)})}async function _e(){const e=await chrome.storage.local.get([k,C]);p=j(e[k]),m=j(e[C]),m.size>0&&(F(p,m.values()),m.clear(),await _())}function be(){const e=new Map;return F(e,p.values()),F(e,m.values()),e}function Ae(e){F(p,e);for(const s of e)m.delete(s.site);_()}function Te(){if(m.size>0)return[];const e=Array.from(p.values()).filter(s=>s.totalPixels>0).map(T);return e.length===0||(m=new Map(e.map(s=>[s.site,T(s)])),p.clear(),_()),e}function Fe(e){for(const s of e)m.delete(s.site);_()}let B=null;const Ne="https://aknzrsgymehrixfwqefq.supabase.co",De="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFrbnpyc2d5bWVocml4ZndxZWZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwMjUyODgsImV4cCI6MjA4NjYwMTI4OH0.ESpNDYKwlK72Ebj19yk5qoUDtOr3PY_rQ5dQSelwZL8",Ke={getItem:async e=>(await chrome.storage.local.get(e))[e]??null,setItem:async(e,s)=>{await chrome.storage.local.set({[e]:s})},removeItem:async e=>{await chrome.storage.local.remove(e)}};function M(){return B||(B=Me(Ne,De,{auth:{storage:Ke,persistSession:!0,autoRefreshToken:!0,lock:async(e,s,t)=>await t(),detectSessionInUrl:!1}})),B}const N=new Map;function ue(e){const s=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${s}-${t}-${o}`}function Ee(e){return ue(new Date(e))}function de(){return ue(new Date)}function Be(){const e=new Date;return e.setHours(0,0,0,0),e.toISOString()}function U(e,s){const t=N.get(e);if(!t)return{dayKey:s,todayMeters:0,todayBysite:{},totalMeters:0,updatedAt:0};if(t.dayKey!==s){const o={...t,dayKey:s,todayMeters:0,todayBysite:{}};return N.set(e,o),o}return t}function Ie(e,s,t){N.set(e,{dayKey:s,todayMeters:t.todayMeters,todayBysite:{...t.todayBysite},totalMeters:t.totalMeters,updatedAt:Date.now()})}function Oe(e,s){const t=de(),o=U(e,t),r={...o,todayBysite:{...o.todayBysite}};for(const n of s){const i=Number(n.totalMeters||0);if(!(!Number.isFinite(i)||i<=0)&&(r.totalMeters+=i,Ee(n.lastUpdate)===t)){const a=K(n.site);if(!a)continue;r.todayMeters+=i,r.todayBysite[a]=(r.todayBysite[a]??0)+i}}r.updatedAt=Date.now(),N.set(e,r)}const $="doomscroller_feature_flags",b={aiAchievements:!0,chatV2:!0,achievementToast:!0};function ye(e){const s=e&&typeof e=="object"?e:{};return{aiAchievements:typeof s.aiAchievements=="boolean"?s.aiAchievements:b.aiAchievements,chatV2:typeof s.chatV2=="boolean"?s.chatV2:b.chatV2,achievementToast:typeof s.achievementToast=="boolean"?s.achievementToast:b.achievementToast}}let x={...b},ee=!1;function Le(e,s){if(s!=="local")return;const t=e[$];t&&(x=ye(t.newValue))}async function Re(){if(ee)return;ee=!0;const e=await chrome.storage.local.get($);x=ye(e[$]),chrome.storage.onChanged.addListener(Le)}function me(){return x}const P="achievementJobsQueue",te=[2e3,1e4,3e4,12e4,3e5],ke=2e3;let h=[],se=!1,I=!1,oe=0;function d(e,s,t){const o=String(e??"").trim();return o?o.slice(0,s):t}function Ce(e){const s=Math.min(Math.max(e-1,0),te.length-1);return te[s]}function Ue(e){return e==="legendary"||e==="epic"||e==="rare"?e:"common"}function $e(e){return Array.isArray(e)?e.filter(t=>!!t&&typeof t=="object").map(t=>t).filter(t=>typeof t.userId=="string"&&typeof t.eventKey=="string").map(t=>{var o,r,n,i,a,c,y,f,l,v,g,u,S,w,Q,Z;return{userId:String(t.userId),eventKey:String(t.eventKey),trigger:{type:d(String(((o=t.trigger)==null?void 0:o.type)??"scroll_pattern"),64,"scroll_pattern"),value:Number(((r=t.trigger)==null?void 0:r.value)??0),site:(n=t.trigger)!=null&&n.site?String(t.trigger.site).toLowerCase():null,timestamp:Number(((i=t.trigger)==null?void 0:i.timestamp)??Date.now())},runtimeSnapshot:{dayKey:d(String(((a=t.runtimeSnapshot)==null?void 0:a.dayKey)??""),32,""),todayMeters:Number(((c=t.runtimeSnapshot)==null?void 0:c.todayMeters)??0),todayBySite:(y=t.runtimeSnapshot)!=null&&y.todayBySite&&typeof t.runtimeSnapshot.todayBySite=="object"?Object.fromEntries(Object.entries(t.runtimeSnapshot.todayBySite).filter(([,E])=>Number.isFinite(E)).map(([E,he])=>[E,Number(he)])):{},rolling30Meters:Number(((f=t.runtimeSnapshot)==null?void 0:f.rolling30Meters)??0),sessionMeters:Number(((l=t.runtimeSnapshot)==null?void 0:l.sessionMeters)??0),sessionDurationSec:Number(((v=t.runtimeSnapshot)==null?void 0:v.sessionDurationSec)??0)},toast:{title:d(String(((g=t.toast)==null?void 0:g.title)??"Doom Achievement"),64,"Doom Achievement"),description:d(String(((u=t.toast)==null?void 0:u.description)??""),200,""),icon:d(String(((S=t.toast)==null?void 0:S.icon)??"ðŸ†"),4,"ðŸ†"),rarity:Ue((w=t.toast)==null?void 0:w.rarity),roastLine:d(String(((Q=t.toast)==null?void 0:Q.roastLine)??""),220,""),appScope:(Z=t.toast)!=null&&Z.appScope?String(t.toast.appScope):null},meta:t.meta&&typeof t.meta=="object"?t.meta:{},attempt:Number(t.attempt??0),nextAttemptAt:Number(t.nextAttemptAt??Date.now()),createdAt:Number(t.createdAt??Date.now())}}).filter(t=>Number.isFinite(t.nextAttemptAt)&&Number.isFinite(t.createdAt)):[]}async function pe(){if(se)return;const e=await chrome.storage.local.get(P);h=$e(e[P]),se=!0}async function fe(){await chrome.storage.local.set({[P]:h})}function Pe(e){return`${e.userId}::${e.eventKey}`}function Ye(e,s){const t=`${e}::${s}`;return h.some(o=>Pe(o)===t)}function Ve(e){return{user_id:e.userId,trigger_type:d(e.trigger.type,64,"scroll_pattern"),trigger_value:Number.isFinite(e.trigger.value)?Number(e.trigger.value):0,title:d(e.toast.title,64,"Doom Achievement"),description:d(e.toast.description||e.toast.roastLine,180,"You unlocked a doomscroll achievement."),icon:d(e.toast.icon,4,"ðŸ†"),earned_at:new Date().toISOString(),event_key:d(e.eventKey,180,`event_${Date.now()}`),rarity:e.toast.rarity,app_scope:e.toast.appScope??e.trigger.site,meta:{roast_line:e.toast.roastLine,trigger:e.trigger,runtime_snapshot:e.runtimeSnapshot,rule_meta:e.meta},source:"rule"}}async function re(e){const s=M(),t=Ve(e),o=await s.from("achievements").insert(t).select("id").single();if(!o.error)return o.data??null;const r=o.error.message.toLowerCase();if(r.includes("duplicate key")){const n=await s.from("achievements").select("id").eq("user_id",e.userId).eq("event_key",t.event_key).order("earned_at",{ascending:!1}).limit(1).maybeSingle();if(!n.error)return n.data??null}if(r.includes("event_key")||r.includes("rarity")||r.includes("app_scope")||r.includes("meta")){const n=await s.from("achievements").insert({user_id:e.userId,trigger_type:t.trigger_type,trigger_value:t.trigger_value,title:t.title,description:t.description,icon:t.icon,earned_at:t.earned_at}).select("id").single();if(!n.error)return n.data??null}throw o.error}async function ze(e){const t=await M().functions.invoke("generate-achievement",{body:{eventKey:e.eventKey,trigger:e.trigger,runtimeSnapshot:e.runtimeSnapshot}});if(t.error)throw t.error;const o=t.data;return(o==null?void 0:o.achievement)??null}async function We(e){if(!me().aiAchievements)return re(e);try{return await ze(e)}catch(t){const o=t instanceof Error?t.message.toLowerCase():"";if(o.includes("function")||o.includes("404")||o.includes("network")||o.includes("failed to fetch"))return re(e);throw t}}function xe(e){e.attempt+=1,e.nextAttemptAt=Date.now()+Ce(e.attempt)}function qe(e,s){chrome.runtime.sendMessage({type:"ACHIEVEMENT_SYNCED",payload:{userId:e.userId,eventKey:e.eventKey,achievementId:s}}).catch(()=>{})}async function Je(e){await pe(),!Ye(e.userId,e.eventKey)&&(h.push({userId:e.userId,eventKey:e.eventKey,trigger:e.trigger,runtimeSnapshot:e.runtimeSnapshot,toast:e.toast,meta:e.meta,attempt:0,nextAttemptAt:Date.now(),createdAt:Date.now()}),await fe())}async function q(){var e;if(!I){I=!0;try{if(await pe(),h.length===0)return;const s=M(),{data:{session:t}}=await s.auth.getSession();if(!((e=t==null?void 0:t.user)!=null&&e.id))return;const o=Date.now(),r=t.user.id,n=[];for(const i of h){if(i.userId!==r){n.push(i);continue}if(i.nextAttemptAt>o){n.push(i);continue}try{const a=await We(i);qe(i,a==null?void 0:a.id)}catch{xe(i),n.push(i)}}h=n,await fe()}finally{I=!1}}}function J(){const e=Date.now();e-oe<ke||(oe=e,q())}const ge="sync-scroll",Ge=5e3;let A=!1,ne=0;function Se(){chrome.alarms.create(ge,{periodInMinutes:ve})}function He(e){e.name===ge&&(G(),q())}function Qe(){const e=Date.now();J(),!A&&(e-ne<Ge||(ne=e,G()))}function Ze(e){const s=e.toLowerCase();return s.includes("foreign key")&&s.includes("scroll_sessions_user_id_fkey")}async function G(){if(A)return;A=!0;const e=M();try{const{data:{session:s}}=await e.auth.getSession();if(!s)return;await X(e,s.user);const t=Te();if(t.length===0)return;const o=t.map(n=>({user_id:s.user.id,site:n.site,pixels_scrolled:Math.round(n.totalPixels),meters_scrolled:parseFloat(n.totalMeters.toFixed(4)),duration_seconds:Math.round((n.lastUpdate-n.sessionStart)/1e3),session_start:new Date(n.sessionStart).toISOString(),session_end:new Date(n.lastUpdate).toISOString()}));let{error:r}=await e.from("scroll_sessions").insert(o);r&&Ze(r.message)&&(await X(e,s.user),r=(await e.from("scroll_sessions").insert(o)).error),r?(console.error("[DoomScroller] Sync failed:",r.message),Ae(t)):(Oe(s.user.id,t),Fe(t),console.log(`[DoomScroller] Synced ${o.length} session(s) to Supabase`))}finally{A=!1,J()}}function ie(e,s){if(s<=0)return{site:null,share:0};const t=Object.entries(e).sort((o,r)=>r[1]-o[1]);return t.length===0?{site:null,share:0}:{site:t[0][0],share:t[0][1]/s}}function Xe(e){const s=[],t=[100,250,500,1e3,2e3];for(const l of t)e.previousTodayMeters<l&&e.todayMeters>=l&&s.push({eventKey:`daily_distance_${l}_${e.dayKey}`,triggerType:"daily_distance_threshold",triggerValue:l,title:`${l}m Regret`,description:`You crossed ${l}m today. Productivity remains theoretical.`,icon:l>=1e3?"ðŸ”¥":"ðŸ†",rarity:l>=1e3?"epic":l>=500?"rare":"common",appScope:null,roastLine:"Your thumb is building endurance faster than your assignments.",meta:{threshold:l,dayKey:e.dayKey}});const o=ie(e.previousTodayBySite,e.previousTodayMeters),r=ie(e.todayBySite,e.todayMeters),n=o.site&&o.share>=.75&&e.previousTodayMeters>=180,i=r.site&&r.share>=.75&&e.todayMeters>=180;!n&&i&&r.site&&s.push({eventKey:`app_specialist_${r.site}_${e.dayKey}`,triggerType:"app_specialist",triggerValue:Number((r.share*100).toFixed(2)),title:`${r.site.toUpperCase()} Loyalist`,description:`${Math.round(r.share*100)}% of today's scroll happened on ${r.site}.`,icon:"ðŸ“±",rarity:"epic",appScope:r.site,roastLine:`You didn't browse apps. You moved into ${r.site}.`,meta:{share:Number(r.share.toFixed(4))}});const a=Object.keys(e.previousTodayBySite).filter(l=>e.previousTodayBySite[l]>0).length,c=Object.keys(e.todayBySite).filter(l=>e.todayBySite[l]>0).length;a<4&&c>=4&&e.todayMeters>=200&&s.push({eventKey:`app_diversity_4_${e.dayKey}`,triggerType:"app_diversity",triggerValue:c,title:"Multi-Feed Tourist",description:`You sampled ${c} apps today. Procrastination buffet unlocked.`,icon:"ðŸŒ€",rarity:"rare",appScope:null,roastLine:"You diversified your distraction portfolio.",meta:{uniqueSites:c}}),e.previousRolling30Meters<40&&e.rolling30Meters>=40&&s.push({eventKey:`burst_scroll_${e.dayKey}`,triggerType:"burst_scroll",triggerValue:Number(e.rolling30Meters.toFixed(2)),title:"Doom Sprint",description:`${Math.round(e.rolling30Meters)}m in 30s. Your thumb is speedrunning.`,icon:"âš¡",rarity:"rare",appScope:e.site,roastLine:"That burst had more urgency than your deadlines.",meta:{windowSeconds:30}});const y=e.previousSessionDurationSec>=20*60&&e.previousSessionMeters>=250,f=e.sessionDurationSec>=20*60&&e.sessionMeters>=250;return!y&&f&&s.push({eventKey:`session_marathon_${e.dayKey}`,triggerType:"session_marathon",triggerValue:Number(e.sessionMeters.toFixed(2)),title:"Infinite Scroll Endurance",description:`You survived a ${Math.round(e.sessionDurationSec/60)} min doom session.`,icon:"ðŸ”¥",rarity:"epic",appScope:r.site??e.site,roastLine:"Your stamina is impressive and deeply concerning.",meta:{sessionDurationSec:Math.round(e.sessionDurationSec)}}),s}const je="achievementRuntimeState:",et=5*60*1e3,tt=30*1e3,Y=400,st=1200,D=new Map,O=new Map,ae=new Set,L=new Map;function V(e){return`${je}${e}`}function H(e){const s=new Date(e),t=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0");return`${t}-${o}-${r}`}function z(e){return{dayKey:H(e),todayMeters:0,todayBySite:{},rollingWindow:[],sessionStartTs:e,sessionMeters:0,lastScrollTs:e,unlockedEventKeys:[]}}function ot(e,s){if(!e||typeof e!="object")return z(s);const t=e,o=z(s);return typeof t.dayKey=="string"&&(o.dayKey=t.dayKey),Number.isFinite(t.todayMeters)&&(o.todayMeters=Number(t.todayMeters)),t.todayBySite&&typeof t.todayBySite=="object"&&(o.todayBySite=Object.fromEntries(Object.entries(t.todayBySite).filter(([,r])=>Number.isFinite(r)).map(([r,n])=>[r,Number(n)]))),Array.isArray(t.rollingWindow)&&(o.rollingWindow=t.rollingWindow.filter(r=>!!r&&typeof r=="object").map(r=>({timestamp:Number(r.timestamp??0),meters:Number(r.meters??0),site:String(r.site??"unknown").toLowerCase()})).filter(r=>Number.isFinite(r.timestamp)&&Number.isFinite(r.meters)&&r.meters>0)),Number.isFinite(t.sessionStartTs)&&(o.sessionStartTs=Number(t.sessionStartTs)),Number.isFinite(t.sessionMeters)&&(o.sessionMeters=Number(t.sessionMeters)),Number.isFinite(t.lastScrollTs)&&(o.lastScrollTs=Number(t.lastScrollTs)),Array.isArray(t.unlockedEventKeys)&&(o.unlockedEventKeys=t.unlockedEventKeys.map(r=>String(r)).filter(r=>r.length>0).slice(-Y)),o}function rt(e,s){const t=D.get(e);if(t)return t;const o=z(s);return D.set(e,o),o}function nt(e){if(L.has(e))return;const s=setTimeout(()=>{L.delete(e);const t=D.get(e);t&&chrome.storage.local.set({[V(e)]:t})},st);L.set(e,s)}async function it(e,s){if(ae.has(e))return;const t=O.get(e);if(t){await t;return}const o=(async()=>{const r=await chrome.storage.local.get(V(e)),n=ot(r[V(e)],s),i=H(s);n.dayKey!==i&&(n.dayKey=i,n.todayMeters=0,n.todayBySite={},n.rollingWindow=[],n.sessionStartTs=s,n.sessionMeters=0),D.set(e,n),ae.add(e)})().finally(()=>{O.delete(e)});O.set(e,o),await o}function ce(e,s){const t=s-tt;e.rollingWindow=e.rollingWindow.filter(o=>o.timestamp>=t)}function W(e){return e.rollingWindow.reduce((s,t)=>s+t.meters,0)}function at(e,s){const t=Math.max(0,(s-e.sessionStartTs)/1e3);return{dayKey:e.dayKey,todayMeters:Number(e.todayMeters.toFixed(2)),todayBySite:{...e.todayBySite},rolling30Meters:Number(W(e).toFixed(2)),sessionMeters:Number(e.sessionMeters.toFixed(2)),sessionDurationSec:Number(t.toFixed(2))}}function ct(e){return{eventKey:e.eventKey,title:e.title,description:e.description,icon:e.icon,rarity:e.rarity,roastLine:e.roastLine,appScope:e.appScope}}function lt(e,s){return e.unlockedEventKeys.includes(s)?!1:(e.unlockedEventKeys.push(s),e.unlockedEventKeys.length>Y&&(e.unlockedEventKeys=e.unlockedEventKeys.slice(-Y)),!0)}async function ut(e,s){if(!s.aiAchievements&&!s.achievementToast)return[];const t=Number(e.meters);if(!Number.isFinite(t)||t<=0)return[];await it(e.userId,e.timestamp);const o=rt(e.userId,e.timestamp),r=H(e.timestamp);o.dayKey!==r&&(o.dayKey=r,o.todayMeters=0,o.todayBySite={},o.rollingWindow=[],o.sessionStartTs=e.timestamp,o.sessionMeters=0),e.timestamp-o.lastScrollTs>et&&(o.sessionStartTs=e.timestamp,o.sessionMeters=0,o.rollingWindow=[]),ce(o,e.timestamp);const n=W(o),i=o.todayMeters,a={...o.todayBySite},c=o.sessionMeters,y=Math.max(0,(e.timestamp-o.sessionStartTs)/1e3);o.todayMeters+=t,o.todayBySite[e.site]=(o.todayBySite[e.site]??0)+t,o.sessionMeters+=t,o.lastScrollTs=e.timestamp,o.rollingWindow.push({timestamp:e.timestamp,meters:t,site:e.site}),ce(o,e.timestamp);const f=W(o),l=Math.max(0,(e.timestamp-o.sessionStartTs)/1e3),v=Xe({dayKey:o.dayKey,site:e.site,timestamp:e.timestamp,todayMeters:o.todayMeters,todayBySite:o.todayBySite,rolling30Meters:f,sessionMeters:o.sessionMeters,sessionDurationSec:l,previousTodayMeters:i,previousTodayBySite:a,previousRolling30Meters:n,previousSessionMeters:c,previousSessionDurationSec:y}),g=[];for(const u of v)lt(o,u.eventKey)&&g.push({userId:e.userId,eventKey:u.eventKey,trigger:{type:u.triggerType,value:u.triggerValue,site:u.appScope,timestamp:e.timestamp},toast:ct(u),runtimeSnapshot:at(o,e.timestamp),meta:u.meta});return nt(e.userId),g}const dt=5e3,yt=250,R=new Map;function mt(e){return new Promise(s=>setTimeout(s,e))}async function pt(){var t;const e=M(),{data:{session:s}}=await e.auth.getSession();return((t=s==null?void 0:s.user)==null?void 0:t.id)??null}function ft(e){const s={};let t=0;for(const o of e){const r=K(o.site);if(!r)continue;const n=Number(o.meters_scrolled??0);Number.isFinite(n)&&(t+=n,s[r]=(s[r]??0)+n)}return{todayMeters:t,todayBysite:s}}function le(e,s,t){const o=R.get(e);if(o)return o;const r=(async()=>{const n=M(),[{data:i},{data:a}]=await Promise.all([n.from("scroll_sessions").select("site, meters_scrolled").eq("user_id",e).gte("created_at",t),n.from("profiles").select("total_meters_scrolled").eq("id",e).single()]),c=ft(i??[]),y=Number((a==null?void 0:a.total_meters_scrolled)??0);Ie(e,s,{todayMeters:parseFloat(c.todayMeters.toFixed(2)),todayBysite:c.todayBysite,totalMeters:parseFloat(y.toFixed(2))})})().finally(()=>{R.delete(e)});return R.set(e,r),r}async function gt(e,s,t,o){const r=await pt();if(!r)return;const n=me(),i=await ut({userId:r,site:e,meters:s,timestamp:t},n);if(i.length!==0){for(const a of i)n.achievementToast&&typeof o=="number"&&chrome.tabs.sendMessage(o,{type:"ACHIEVEMENT_TOAST",payload:a.toast}).catch(()=>{}),await Je(a);J()}}function St(e,s,t){var o;switch(e.type){case"SCROLL_UPDATE":{const{site:r,pixels:n,meters:i,timestamp:a}=e.payload,c=K(r);return!c||!Number.isFinite(n)||!Number.isFinite(i)||n<=0||i<=0?(t({ok:!1}),!1):(we(c,n,i),Qe(),gt(c,i,a,(o=s.tab)==null?void 0:o.id),t({ok:!0}),!1)}case"GET_STATS":return ht().then(t).catch(()=>{t({todayMeters:0,todayBysite:{},totalMeters:0})}),!0;default:return!1}}async function ht(){const e=be();let s=0;const t={};for(const[u,S]of e){const w=K(u);w&&(s+=S.totalMeters,t[w]=(t[w]??0)+S.totalMeters)}const o=M(),{data:{session:r}}=await o.auth.getSession();if(!r)return{todayMeters:parseFloat(s.toFixed(2)),todayBysite:t,totalMeters:parseFloat(s.toFixed(2))};const n=r.user.id,i=de(),a=Be();let c=U(n,i);const y=c.updatedAt===0,f=Date.now()-c.updatedAt>dt;y?await Promise.race([le(n,i,a),mt(yt)]):f&&le(n,i,a),c=U(n,i);const l={...c.todayBysite};for(const[u,S]of Object.entries(t))l[u]=(l[u]??0)+S;const v=c.todayMeters+s,g=c.totalMeters+s;return{todayMeters:parseFloat(v.toFixed(2)),todayBysite:l,totalMeters:parseFloat(g.toFixed(2))}}console.log("[DoomScroller] Background service worker loaded");_e();Re();chrome.runtime.onInstalled.addListener(()=>{console.log("[DoomScroller] Extension installed"),Se()});Se();G();q();chrome.runtime.onMessage.addListener(St);chrome.alarms.onAlarm.addListener(He);
